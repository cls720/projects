(window.webpackJsonpzhcCmps=window.webpackJsonpzhcCmps||[]).push([[2],{257:function(t,e,n){"use strict";var o=n(63);n.n(o).a},258:function(t,e,n){(t.exports=n(8)(!1)).push([t.i,".zhc-birt-print-bar[data-v-52556f56]{text-align:right;padding:10px}\n",""])},259:function(t,e,n){"use strict";var o=n(64);n.n(o).a},260:function(t,e,n){(t.exports=n(8)(!1)).push([t.i,".zhc-birt-sheet[data-v-c8ef8dce]{overflow:auto}\n",""])},466:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"zhc-birt-book"},[t.isShowToolBar()?n("birt-tool-bar",{ref:"pageBar",attrs:{"total-page":t.getTotalPage(),"birt-model":t.birtModel},on:{"page-change":t.onPageChange}},[t.birtModel.canEdit?n("el-button",{attrs:{icon:"el-icon-edit"},on:{click:function(e){return t.doEdit()}}},[t._v("编辑")]):t._e()],1):t._e(),t._v(" "),t.isRenderTabs()?n("el-tabs",{attrs:{"tab-position":t.tabPosition},on:{"tab-click":t.onTabClick},model:{value:t.activeTabId,callback:function(e){t.activeTabId=e},expression:"activeTabId"}},t._l(t.birtModel.sheets,function(e,o){return n("el-tab-pane",{key:e.controlId,attrs:{label:e.name,name:e.controlId}},[n("birt-sheet",{key:t.curtSheet.controlId,style:t.getCurtSheetStyle(),attrs:{layout:t.getCurtSheetLayout()}})],1)}),1):n("birt-sheet",{key:t.curtSheet.controlId,style:t.getCurtSheetStyle(),attrs:{layout:t.getCurtSheetLayout()}}),t._v(" "),n("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:t.editDialogVisible,top:"40px",title:"修改报表数据模型"},on:{"update:visible":function(e){t.editDialogVisible=e}}},[n("el-input",{attrs:{type:"textarea",rows:20},model:{value:t.birtModelStr,callback:function(e){t.birtModelStr=e},expression:"birtModelStr"}}),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){return t.cancelEdit()}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.applyEdit()}}},[t._v("确 定")])],1)],1)],1)};o._withStripped=!0;n(3);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"no-print zhc-birt-print-bar"},[t.totalPage>1?n("el-pagination",{staticStyle:{float:"left"},attrs:{background:"",layout:"prev, pager, next","page-size":1,"pager-count":5,total:t.totalPage,"current-page":t.currentPage},on:{"current-change":t.onCurrentPageChange}}):t._e(),t._v(" "),n("el-button-group",[t._t("default"),t._v(" "),n("el-button",{attrs:{icon:"el-icon-printer"},on:{click:function(e){return t.doPrint()}}},[t._v("打印")]),t._v(" "),n("el-dropdown",[n("el-button",[t._v("\n        输出\n        "),n("i",{staticClass:"el-icon-download el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[n("span",{on:{click:function(e){return t.onExprotPdf()}}},[t._v("PDF")])]),t._v(" "),n("el-dropdown-item",[t._v("Excel")]),t._v(" "),n("el-dropdown-item",[t._v("Word")]),t._v(" "),n("el-dropdown-item",[t._v("图片")])],1)],1)],2)],1)};r._withStripped=!0;n(21);var i=n(87),a=n(88),l={name:"BirtToolBar",props:{totalPage:{type:Number,default:1}},data:function(){return{currentPage:1}},methods:{doPrint:function(){Object(i.default)("print_div","html")},setCurrentPage:function(t){this.currentPage=t},onCurrentPageChange:function(t){this.$emit("page-change",t-1)},onExprotPdf:function(){console.log(window.location),Object(a.a)(window.location.href).then(function(t){var e=window.URL.createObjectURL(new Blob([t.data]));window.open(e)}).catch(function(t){console.log(t)})}}},s=(n(257),n(1)),c=Object(s.a)(l,r,[],!1,null,"52556f56",null);c.options.__file="src/components/BirtToolBar/index.vue";var u=c.exports,d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"zhc-birt-sheet"},[n("div",{style:t.layout.style,attrs:{id:"print_div"}},[t._l(t.layout,function(e,o){return[t._l(e,function(e,r){return"rows"===o?n("row-birt",{key:"r"+r,attrs:{row:e}}):t._e()}),t._v(" "),t._l(e,function(e,r){return"cols"===o?n("col-birt",{key:"c"+r,attrs:{col:e}}):t._e()}),t._v(" "),t._l(e,function(e,r){return"tables"===o?n("table-birt",{key:"t"+r,attrs:{tb:e}}):t._e()}),t._v(" "),t._l(e,function(e,r){return"forms"===o?n("form-birt",{key:"frm"+r,attrs:{frm:e}}):t._e()})]})],2)])};d._withStripped=!0;var h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-row",[t._l(t.row,function(e,o){return[t._l(e,function(e,r){return"cols"===o?n("col-birt",{key:"c"+r,attrs:{col:e}}):t._e()}),t._v(" "),t._l(e,function(e,r){return"tables"===o?n("table-birt",{key:"t"+r,attrs:{tb:e}}):t._e()})]})],2)};h._withStripped=!0;var p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-col",{style:{width:t.col.width+"px"},attrs:{span:t.col.span}},[t._l(t.col,function(e,o){return[t._l(e,function(e,r){return"rows"===o?n("row-birt",{key:"r"+r,attrs:{row:e}}):t._e()}),t._v(" "),t._l(e,function(e,r){return"tables"===o?n("table-birt",{key:"t"+r,attrs:{tb:e}}):t._e()})]})],2)};p._withStripped=!0;var f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"zhc-birt-sheet-table"},["pageSplit"===t.tb.rowSplit?n("div",{staticStyle:{"page-break-after":"always"}}):t._e(),t._v(" "),n("table",{style:t.tb.style},[n("thead",[n("tr",t._l(t.tb.cols,function(t){return n("th",{style:{width:t.colWidth+"px"}})}),0)]),t._v(" "),n("tbody",t._l(t.tb.rows,function(e){return n("tr",{style:{height:e.rowHeight+"px"}},t._l(e.tds,function(e){return n("td",{style:t.getTdStyle(e),attrs:{rowspan:e.rowspan,colspan:e.colspan}},[e.children?n("birt-cell-children",{attrs:{children:e.children}}):e.viewStyle?n("view-style",{attrs:{"td-obj":e}}):e.hrefs&&e.hrefs.length>0?n("hc-link-hrefs",{attrs:{"td-obj":e}}):n("span",[t._v(t._s(e.value))])],1)}),0)}),0)])])};f._withStripped=!0;var b=n(48),g=n(54),v=n(90),y={name:"TableBirt",components:{BirtCellChildren:b.default,HcLinkHrefs:g.a,ViewStyle:v.a},props:{tb:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{initConditionExpr:function(){for(var t in this.tb.rows){var e=this.tb.rows[t];for(var n in e.tds){var o=e.tds[n];o.conditionExprs&&this.setTdStyleByConditionExpr(o,e)}}this.tb.hasInitConditionExpr=!0},getTdStyle:function(t){var e=t.style||"";return t.styleExpr&&(e+=t.styleExpr()||""),e},setTdStyleByConditionExpr:function(t,e){var n=this;t.conditionExprs.forEach(function(o){o.expr.call()&&o.applyItems.forEach(function(o){var r=n.getApplyItemStyle(o);"applyCell"===o.applyScheme?(void 0===t.style&&(t.style=""),t.style+=r):"applyRow"===o.applyScheme?n.setTrStyleByApplyRow(e,r):"applyCol"===o.applyScheme&&n.setTdStyleByConditionExpr(t,r)})})},setTrStyleByApplyRow:function(t,e){for(var n in t.tds){t.tds[n].style+=e}},setColStyleByApplyRow:function(t,e){},getApplyItemStyle:function(t){var e="";return"ConditionApplyColor"===t.controlName?e+="color:".concat(t.color,";"):"ConditionApplyBackgroundColor"===t.controlName&&(e+="background-color:".concat(t.backgroundColor,";")),e}},created:function(){this.tb.hasInitConditionExpr||this.initConditionExpr()}},m=Object(s.a)(y,f,[],!1,null,"759dd07b",null);m.options.__file="src/components/BirtSheet/layout/TableBirt.vue";var _=m.exports,w={name:"ColBirt",components:{RowBirt:T,TableBirt:_},props:{col:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{}},S=Object(s.a)(w,p,[],!1,null,"01f83f2d",null);S.options.__file="src/components/BirtSheet/layout/ColBirt.vue";var x=S.exports,B={name:"RowBirt",components:{ColBirt:x,TableBirt:_},props:{row:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{}},C=Object(s.a)(B,h,[],!1,null,"1a4f7d87",null);C.options.__file="src/components/BirtSheet/layout/RowBirt.vue";var T=C.exports,k=function(){var t=this.$createElement,e=this._self._c||t;return e("el-container",{staticClass:"zhc-birt-sheet-form"},[e("el-main",[this.frm.children?e("birt-cell-children",{attrs:{children:this.frm.children}}):this._e()],1)],1)};k._withStripped=!0;var I={name:"FormBirt",components:{BirtCellChildren:b.default},props:{frm:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{}},M=Object(s.a)(I,k,[],!1,null,"4645fe99",null);M.options.__file="src/components/BirtSheet/layout/FormBirt.vue";var E={name:"BirtSheet",components:{RowBirt:T,ColBirt:x,TableBirt:_,FormBirt:M.exports},props:{layout:{type:Object,default:function(){return{}}}},data:function(){return{}},watch:{},methods:{}},P=(n(259),Object(s.a)(E,d,[],!1,null,"c8ef8dce",null));P.options.__file="src/components/BirtSheet/index.vue";var O=P.exports,j=n(74),H=n(89),D=(n(5),n(57),n(56),{bind:function(t,e,n){var o=t.querySelector(".el-dialog__header"),r=t.querySelector(".el-dialog");o.style.cssText+=";cursor:move;",r.style.cssText+=";top:0px;";var i=window.document.currentStyle?function(t,e){return t.currentStyle[e]}:function(t,e){return getComputedStyle(t,!1)[e]};o.onmousedown=function(t){var e=t.clientX-o.offsetLeft,a=t.clientY-o.offsetTop,l=r.offsetWidth,s=r.offsetHeight,c=document.body.clientWidth,u=document.body.clientHeight,d=r.offsetLeft,h=c-r.offsetLeft-l,p=r.offsetTop,f=u-r.offsetTop-s,b=i(r,"left"),g=i(r,"top");b.includes("%")?(b=+document.body.clientWidth*(+b.replace(/\%/g,"")/100),g=+document.body.clientHeight*(+g.replace(/\%/g,"")/100)):(b=+b.replace(/\px/g,""),g=+g.replace(/\px/g,"")),document.onmousemove=function(t){var o=t.clientX-e,i=t.clientY-a;-o>d?o=-d:o>h&&(o=h),-i>p?i=-p:i>f&&(i=f),r.style.cssText+=";left:".concat(o+b,"px;top:").concat(i+g,"px;"),n.child.$emit("dragDialog")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}}}}),R=function(t){t.directive("el-drag-dialog",D)};window.Vue&&(window["el-drag-dialog"]=D,Vue.use(R)),D.install=R;var z=D,$=n(69),V={name:"BirtBook",components:{BirtToolBar:u,BirtSheet:O},directives:{elDragDialog:z},props:{},data:function(){return{curtPageIndex:0,screenHeight:window.innerHeight,editDialogVisible:!1,birtModel:function(){return{}},birtModelStr:"",datasource:{},dataset:{}}},provide:function(){return{datasource:this.datasource,dataset:this.dataset}},computed:{mainHeight:function(){var t=this.screenHeight;return this.isShowToolBar()&&(t-=60),this.$store.state.tagsView.isTagFullscreen||(t-=84),t},activeTabId:{get:function(){return this.curtSheet.controlId},set:function(t){}},renderType:function(){return this.birtModel&&this.birtModel.renderType||"pages"},tabPosition:function(){return this.birtModel&&this.birtModel.tabPosition||"right"},curtSheet:function(){if(this.birtModel.sheets)for(var t=0,e=0,n=this.birtModel.sheets.length;e<n;e++){var o=this.birtModel.sheets[e];if(!o.layouts)return void console.error("报表模型数据格式错误,sheet.layouts未定义");if(t+=o.layouts.length,this.curtPageIndex<t){var r=this.birtModel.sheets[e];return this.initDataSets(r.dataSets),r}}return{}}},watch:{screenHeight:function(t){if(!this.timer){this.screenHeight=t,this.timer=!0;var e=this;setTimeout(function(){e.timer=!1},400)}},birtModel:function(){""==this.birtModelStr&&(this.birtModelStr=JSON.stringify(this.birtModel))}},methods:{isShowToolBar:function(){return void 0===this.birtModel.showToolBar||this.birtModel.showToolBar},autoWidth:function(){return"100%"},autoHeight:function(){return this.mainHeight},loadBirtModel:function(t,e){var n=this;Object($.a)(t,e).then(function(t){var e=t.data;n.birtModel=e,n.initDataSources(n.birtModel.dataSources)})},registerResize:function(){var t=this;window.onresize=function(){t.screenHeight=window.innerHeight}},initDataSources:function(t){if(t){var e=this;t.forEach(function(t){e.datasource[t.controlId]||(t.dataset=e.dataset,e.datasource[t.controlId]=j.a.newInstance(t))})}},initDataSets:function(t){if(t){var e=this;t.forEach(function(t){e.dataset[t.controlId]||(e.dataset[t.controlId]=j.a.newInstance(t))})}},getDataSetInstance:function(t){return this.dataset[t]},getTotalPage:function(){return this.birtModel.totalPage},isRenderTabs:function(){return"tabs"===this.renderType},getCurtSheetLayout:function(){if(this.curtSheet.layouts){void 0===this.curtSheet.pageIndex&&console.error("报表模型数据格式错误,sheet.pageIndex起始页未定义");var t=this.curtPageIndex-this.curtSheet.pageIndex;return this.curtSheet.layouts[t]}},getCurtSheetStyle:function(){return(this.curtSheet.style||"")+"height:".concat(this.mainHeight,"px;")},getSheetByIndex:function(t){if(this.birtModel.sheets)return this.birtModel.sheets[t]},doEdit:function(){this.editDialogVisible=!0},cancelEdit:function(){this.editDialogVisible=!1,this.birtModelStr=JSON.stringify(this.birtModel)},applyEdit:function(){this.editDialogVisible=!1,this.birtModel=JSON.parse(this.birtModelStr)},onPageChange:function(t){this.curtPageIndex=t},onTabClick:function(t,e){var n=this.getSheetByIndex(t.index);n&&(this.$refs.pageBar.setCurrentPage(n.pageIndex+1),this.curtPageIndex=n.pageIndex)}},mounted:function(){this.registerResize(),this.loadBirtModel(this.$route.path,this.$route.query)},beforeDestroy:function(){for(var t in this.datasource){var e=this.datasource[t];e instanceof H.a&&e.close()}}},L=Object(s.a)(V,o,[],!1,null,"684ee8f6",null);L.options.__file="src/components/BirtBook/index.vue";e.default=L.exports},63:function(t,e,n){var o=n(258);"string"==typeof o&&(o=[[t.i,o,""]]);var r={insert:"head",singleton:!1};n(9)(o,r);o.locals&&(t.exports=o.locals)},64:function(t,e,n){var o=n(260);"string"==typeof o&&(o=[[t.i,o,""]]);var r={insert:"head",singleton:!1};n(9)(o,r);o.locals&&(t.exports=o.locals)}}]);